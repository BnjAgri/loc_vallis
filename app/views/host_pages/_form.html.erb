<% current_image_src = host_page.image.attached? ? url_for(host_page.image) : host_page.image_url %>

<%= simple_form_for(host_page, url: host_path, method: :patch) do |f| %>
	<div class="card lv-card">
		<div class="card-body">
			<div class="row g-3">
				<div class="col-12">
					<%= f.input :title, label: "Titre" %>
				</div>

				<div class="col-12">
					<%= f.input :content, as: :text, label: "Contenu", input_html: { rows: 10 } %>
				</div>

				<div class="col-12">
					<%= f.input :image_url, label: "Image URL", hint: "Collez une URL, ou utilisez Cloudinary ci-dessous." %>
				</div>

				<div class="col-12">
					<div data-controller="image-preview">
						<label class="form-label">Image (Cloudinary)</label>

						<div class="d-flex flex-wrap gap-2 align-items-center">
							<%= f.file_field :image,
								id: "host_page_image_upload",
								class: "d-none",
								accept: "image/*",
								direct_upload: true,
								data: { action: "change->image-preview#preview", image_preview_target: "input" } %>
							<label for="host_page_image_upload" class="btn btn-outline-primary">Ajouter une image</label>
							<% if host_page.image.attached? %>
								<span class="lv-meta">Image ajoutée</span>
							<% end %>
						</div>

						<% if current_image_src.present? %>
							<div class="mt-3">
								<img
									src="<%= current_image_src %>"
									alt="Aperçu de l'image"
									class="img-fluid rounded"
									style="max-height: 220px; object-fit: cover;"
									data-image-preview-target="preview"
								>
							</div>
						<% else %>
							<div class="mt-3 d-none" data-image-preview-target="container">
								<img
									alt="Aperçu de l'image"
									class="img-fluid rounded"
									style="max-height: 220px; object-fit: cover;"
									data-image-preview-target="preview"
								>
							</div>
						<% end %>

						<div class="form-text">L’image est stockée sur Cloudinary via Active Storage (si configuré).</div>
					</div>
				</div>
			</div>
		</div>

		<div class="card-footer d-flex justify-content-end gap-2">
			<%= link_to "Annuler", host_path, class: "btn btn-soft" %>
			<%= f.button :submit, "Enregistrer", class: "btn btn-primary" %>
		</div>
	</div>
<% end %>
