<%# locals: room:, href: nil, image_url: nil, min_period: nil %>
<% room = local_assigns.fetch(:room) %>
<% href = local_assigns[:href] || room_path(room) %>

<% image_url = local_assigns[:image_url] %>
<% image_url ||= if room.photos.attached?
  url_for(room.photos.first)
elsif room.image_urls.any?
  room.image_urls.first
else
  "https://raw.githubusercontent.com/lewagon/fullstack-images/master/uikit/breakfast.jpg"
end %>

<% min_period = local_assigns[:min_period] || room.opening_periods.min_by(&:nightly_price_cents) %>

<%= link_to href, class: "text-decoration-none" do %>
  <div class="card lv-card h-100 overflow-hidden">
    <div style="height: 190px; overflow: hidden;">
      <%= image_tag image_url, alt: room.name, class: "w-100 h-100", style: "object-fit: cover;" %>
    </div>

    <div class="card-body">
      <div class="d-flex align-items-start justify-content-between gap-3">
        <div>
          <div class="h5 mb-1"><%= room.name %></div>
          <% if room.capacity.present? %>
            <div class="lv-meta"><%= t("rooms.index.capacity", count: room.capacity) %></div>
          <% end %>
        </div>
        <div class="text-end">
          <% if min_period.present? %>
            <div class="lv-meta"><%= t("rooms.index.from_price") %></div>
            <div class="fw-bold"><%= format_price(min_period.nightly_price_cents, currency: min_period.currency) %><span class="lv-meta"> <%= t("rooms.index.per_night") %></span></div>
          <% end %>
        </div>
      </div>

      <div class="d-flex align-items-center mt-3">
        <%= render "shared/review_stars", rating: room.average_rating, count: room.reviews_count.to_i %>
        <span class="btn btn-accent btn-sm ms-auto"><%= t("rooms.index.book_button") %></span>
      </div>
    </div>
  </div>
<% end %>
