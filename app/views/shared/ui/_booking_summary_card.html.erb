<%# locals: booking:, actions: nil %>
<% show_user = local_assigns.fetch(:show_user, true) %>
<% nights_total_cents = booking.total_price_cents.to_i - booking.selected_optional_services_total_cents.to_i %>

<div class="card lv-card">
  <div class="card-body">
    <div class="d-flex align-items-start justify-content-between gap-3">
      <div>
        <div class="text-uppercase lv-muted small"><%= t(".label") %></div>
        <div class="h5 mb-1">#<%= booking.id %></div>
        <% if show_user %>
          <div class="lv-meta"><%= t(".traveler") %> <%= booking.user.email %></div>
        <% end %>
      </div>
      <div class="text-end">
        <%= render "shared/ui/status_badge", status: booking.status %>
      </div>
    </div>

    <hr class="my-3 lv-divider" />

    <div class="row g-3">
      <div class="col-12 col-md-6">
        <div class="lv-meta"><%= t(".dates") %></div>
        <div class="fw-semibold">
          <%= l(booking.start_date, format: :short) %> → <%= l(booking.end_date, format: :short) %>
        </div>
        <div class="lv-meta mt-1"><%= t(".nights", count: booking.nights) %></div>
      </div>

      <div class="col-12 col-md-6">
        <div class="lv-meta"><%= t(".total") %></div>
        <div class="lv-card__kpi">
          <div class="lv-card__kpi-value h4 mb-0"><%= format_price(booking.total_price_cents, currency: booking.currency) %></div>
          <div class="lv-card__kpi-label"><%= t(".tax_included") %></div>
        </div>
        <div class="lv-meta"><%= t(".subtotal_nights") %> <%= format_price(nights_total_cents, currency: booking.currency) %></div>
        <% if booking.selected_optional_services_total_cents.to_i.positive? %>
          <div class="lv-meta"><%= t(".subtotal_services") %> <%= format_price(booking.selected_optional_services_total_cents, currency: booking.currency) %></div>
        <% end %>
      </div>
    </div>

    <% if Array(booking.selected_optional_services).any? %>
      <hr class="my-3 lv-divider" />
      <div class="fw-semibold mb-2"><%= t(".optional_services") %></div>
      <ul class="lv-list mb-0">
        <% Array(booking.selected_optional_services).each do |service| %>
          <% next unless service.is_a?(Hash) %>
          <% name = (service["name"] || service[:name]).to_s.strip %>
          <% price_cents = service["price_cents"] || service[:price_cents] %>
          <% next if name.blank? || price_cents.blank? %>
          <li><%= name %> — <%= format_price(price_cents, currency: booking.currency) %></li>
        <% end %>
      </ul>
    <% end %>

    <% if defined?(actions) && actions.present? %>
      <hr class="my-3 lv-divider" />
      <div class="d-flex flex-wrap gap-2">
        <%= actions %>
      </div>
    <% end %>
  </div>
</div>
