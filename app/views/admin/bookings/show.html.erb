<div class="container py-4">
  <div class="row g-4">
    <div class="col-12 col-lg-5">
      <div class="card h-100">
        <div class="card-body">
          <h1 class="h4 mb-3">Réservation #<%= @booking.id %></h1>

          <p class="mb-1">Voyageur : <%= @booking.user.email %></p>
          <p class="mb-1">Statut : <strong><%= booking_status_label(@booking.status) %></strong></p>
          <p class="mb-1">Dates : <%= @booking.start_date.strftime("%d/%m/%Y") %> → <%= @booking.end_date.strftime("%d/%m/%Y") %></p>

          <% nights_total_cents = @booking.total_price_cents.to_i - @booking.selected_optional_services_total_cents.to_i %>
          <p class="mb-1">Nuits : <%= @booking.nights %></p>
          <p class="mb-1 text-muted">Sous-total nuits : <%= format_price_euros(nights_total_cents) %></p>

          <% if Array(@booking.selected_optional_services).any? %>
            <div class="mt-3">
              <div class="fw-semibold">Services optionnels</div>
              <ul class="mb-2">
                <% Array(@booking.selected_optional_services).each do |service| %>
                  <% next unless service.is_a?(Hash) %>
                  <% name = (service["name"] || service[:name]).to_s.strip %>
                  <% price_cents = service["price_cents"] || service[:price_cents] %>
                  <% next if name.blank? || price_cents.blank? %>
                  <li><%= name %> — <%= format_price_euros(price_cents) %></li>
                <% end %>
              </ul>
              <div class="text-muted">Sous-total services : <%= format_price_euros(@booking.selected_optional_services_total_cents) %></div>
            </div>
          <% end %>

          <p class="mb-3">Total : <%= format_price_euros(@booking.total_price_cents) %></p>

          <div class="d-flex flex-wrap gap-2">
            <% if policy(@booking).approve? %>
              <%= button_to "Approuver", approve_admin_booking_path(@booking), method: :patch, class: "btn btn-success" %>
              <%= button_to "Refuser", decline_admin_booking_path(@booking), method: :patch, class: "btn btn-outline-danger" %>
            <% end %>

            <% if policy(@booking).cancel? %>
              <%= button_to "Annuler", cancel_admin_booking_path(@booking), method: :patch, class: "btn btn-outline-danger" %>
            <% end %>

            <% if policy(@booking).refund? %>
              <%= button_to "Rembourser", refund_admin_booking_path(@booking), method: :post, class: "btn btn-warning", data: { turbo_confirm: "Effectuer un remboursement pour cette réservation ?" } %>
            <% end %>
          </div>
        </div>
      </div>
    </div>

    <div class="col-12 col-lg-7">
      <div class="card h-100">
        <div class="card-body">
          <%= render "shared/messages", booking: @booking, messages: @messages %>
        </div>
      </div>
    </div>
  </div>
</div>
