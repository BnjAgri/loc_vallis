<div class="container py-4">
  <%= render "shared/ui/page_header",
    title: "Réservation ##{@booking.id}",
    subtitle: "Gérez la réservation et la conversation avec le voyageur." %>

  <div class="row g-4 mt-1">
    <div class="col-12 col-lg-5">
      <% actions = capture do %>
        <% if policy(@booking).approve? %>
          <%= button_to "Approuver", approve_admin_booking_path(id: @booking), method: :patch, class: "btn btn-primary" %>
          <%= button_to "Refuser", decline_admin_booking_path(id: @booking), method: :patch, class: "btn btn-outline-danger" %>
        <% end %>

        <% if policy(@booking).cancel? %>
          <%= button_to t("shared.actions.cancel"), cancel_admin_booking_path(id: @booking), method: :patch, class: "btn btn-outline-danger" %>
        <% end %>

        <% if policy(@booking).refund? %>
          <%= form_with url: refund_admin_booking_path(id: @booking), method: :post,
                data: {
                  controller: "refund-options",
                  action: "submit->refund-options#confirm",
                  "refund-options-max-cents-value": @booking.total_price_cents.to_i,
                  "refund-options-services-cents-value": @booking.selected_optional_services_total_cents.to_i,
                  "refund-options-currency-value": @booking.currency.to_s
                },
                class: "d-inline" do %>
            <%= hidden_field_tag :amount_cents, "" %>
            <%= submit_tag "Rembourser", class: "btn btn-warning" %>
          <% end %>
        <% end %>
      <% end %>

      <%= render "shared/ui/booking_summary_card", booking: @booking, actions: actions %>
    </div>

    <div class="col-12 col-lg-7">
      <div class="card lv-card h-100">
        <div class="card-body">
          <div class="d-flex align-items-start justify-content-between gap-2 mb-2">
            <div>
              <div class="text-uppercase lv-muted small">Conversation</div>
              <div class="h5 mb-0">Messages</div>
            </div>
          </div>

          <hr class="my-3 lv-divider" />

          <%= render "shared/messages",
            booking: @booking,
            messages: @messages,
            composer_position: :top,
            scroll_behavior: :none %>
        </div>
      </div>
    </div>
  </div>
</div>
