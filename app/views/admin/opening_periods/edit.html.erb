<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <h1 class="h4 mb-0">Modifier la période d'ouverture</h1>
      <div class="text-muted"><%= @room.name %></div>
    </div>

    <div>
      <%= link_to "Retour", admin_room_path(id: @room), class: "btn btn-link" %>
    </div>
  </div>

  <div class="card">
    <div class="card-body">
      <%= simple_form_for([:admin, @room, @opening_period]) do |f| %>
        <div class="row">
          <div class="col-md-3">
            <%= f.input :start_date,
                        as: :string,
                        label: "Date de début",
                        input_html: {
                          type: "text",
                          data: {
                            controller: "flatpickr",
                            "flatpickr-open-ranges-value": (@other_open_ranges || []).to_json,
                            "flatpickr-booked-ranges-value": (@booked_ranges || []).to_json,
                            "flatpickr-pending-ranges-value": (@pending_ranges || []).to_json
                          }
                        } %>
          </div>

          <div class="col-md-3">
            <%= f.input :end_date,
                        as: :string,
                        label: "Date de fin",
                        input_html: {
                          type: "text",
                          data: {
                            controller: "flatpickr",
                            "flatpickr-open-ranges-value": (@other_open_ranges || []).to_json,
                            "flatpickr-booked-ranges-value": (@booked_ranges || []).to_json,
                            "flatpickr-pending-ranges-value": (@pending_ranges || []).to_json
                          }
                        } %>
          </div>

          <div class="col-md-3">
            <%= f.input :nightly_price_euros,
                        label: "Prix par nuit (€)",
                        input_html: { inputmode: "decimal", step: "0.01", min: 0 } %>
          </div>

          <div class="col-md-3">
            <%= f.input :currency, label: "Devise" %>
          </div>
        </div>

        <div class="d-flex gap-2">
          <%= f.submit "Enregistrer", class: "btn btn-primary" %>
          <%= link_to "Annuler", admin_room_path(id: @room), class: "btn btn-outline-secondary" %>
        </div>
      <% end %>
    </div>
  </div>

  <div class="card mt-4" id="delete-days">
    <div class="card-body">
      <h2 class="h6 mb-1">Supprimer des jours de la période</h2>
      <div class="text-muted small mb-3">
        La plage supprimée sera fermée (la période sera raccourcie ou scindée).
      </div>

      <%= form_with url: block_admin_room_opening_period_path(room_id: @room, id: @opening_period), method: :patch, class: "d-flex flex-wrap gap-3 align-items-end" do %>
        <div class="flex-grow-1" style="min-width: 180px;">
          <label class="form-label" for="block_start_date">Du</label>
          <input
            id="block_start_date"
            name="block[start_date]"
            type="text"
            class="form-control"
            min="<%= @opening_period.start_date %>"
            max="<%= (@opening_period.end_date - 1.day) %>"
            data-controller="flatpickr"
            data-flatpickr-disable-open-ranges-value="false"
            data-flatpickr-open-ranges-value="<%= (@open_ranges || []).to_json %>"
            data-flatpickr-booked-ranges-value="<%= (@booked_ranges || []).to_json %>"
            data-flatpickr-pending-ranges-value="<%= (@pending_ranges || []).to_json %>"
            required
          />
        </div>

        <div class="flex-grow-1" style="min-width: 180px;">
          <label class="form-label" for="block_end_date">Au</label>
          <input
            id="block_end_date"
            name="block[end_date]"
            type="text"
            class="form-control"
            min="<%= (@opening_period.start_date + 1.day) %>"
            max="<%= @opening_period.end_date %>"
            data-controller="flatpickr"
            data-flatpickr-disable-open-ranges-value="false"
            data-flatpickr-open-ranges-value="<%= (@open_ranges || []).to_json %>"
            data-flatpickr-booked-ranges-value="<%= (@booked_ranges || []).to_json %>"
            data-flatpickr-pending-ranges-value="<%= (@pending_ranges || []).to_json %>"
            required
          />
        </div>

        <div class="flex-shrink-0" style="min-width: 180px;">
          <button type="submit" class="btn btn-outline-danger w-100">Supprimer</button>
        </div>
      <% end %>

      <div class="form-text mt-2">Date de fin exclue (comme une réservation).</div>
    </div>
  </div>
</div>
