<div class="banner">
  <div class="container">
    <h1><%= sanitize(t(".welcome_html", owner: @hero_owner_name, location: @hero_location), tags: %w[strong]) %></h1>
    <p><%= t(".subtitle") %></p>
  </div>
</div>

<h1><%= t(".accommodations") %></h1>

<div class="container mt-4">
  <div class="row g-3">
    <% @rooms.each do |room| %>
      <% image_url = if room.photos.attached?
        url_for(room.photos.first)
      elsif room.image_urls.any?
        room.image_urls.first
      else
        "https://raw.githubusercontent.com/lewagon/fullstack-images/master/uikit/breakfast.jpg"
      end %>

      <% min_period = room.opening_periods.min_by(&:nightly_price_cents) %>

      <div class="col-12 col-md-6 col-lg-4">
        <div class="bg-white">
          <%= link_to room_path(room), class: "text-decoration-none" do %>
            <div
              class="card-category"
              style="background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('<%= image_url %>')"
            >
              <span class="card-category__title"><%= room.name %></span>
            </div>
          <% end %>

          <div class="p-2">
            <% if room.capacity.present? %>
              <div class="text-muted"><%= t(".capacity", count: room.capacity) %></div>
            <% end %>

            <% if min_period.present? %>
              <div>
                <%= t(".from_price") %>
                <%= format_price_euros(min_period.nightly_price_cents) %>
                <%= t(".per_night") %>
              </div>
            <% end %>

            <div class="d-flex align-items-center mt-2">
              <%= render "shared/review_stars", rating: room.average_rating, count: room.reviews_count.to_i %>
              <%= link_to t('rooms.index.book_button'), room_path(room), class: "btn btn-flat btn-sm ms-auto" %>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>

<% mapbox_access_token = ENV["MAPBOX_ACCESS_TOKEN"].to_s %>
<% map_address = ENV.fetch("MAP_ADDRESS", "AnglÃ¨s, France") %>
<% map_lat = ENV.fetch("MAP_LAT", "43.5644").to_f %>
<% map_lng = ENV.fetch("MAP_LNG", "2.5617").to_f %>

<div class="container mt-4">
  <div class="row g-3">
    <div class="col-12 col-lg-8">
      <div class="card-category p-0" style="height: 320px; display: block;">
        <% if mapbox_access_token.present? %>
          <div
            data-controller="mapbox"
            data-mapbox-access-token-value="<%= mapbox_access_token %>"
            data-mapbox-lat-value="<%= map_lat %>"
            data-mapbox-lng-value="<%= map_lng %>"
            data-mapbox-zoom-value="13"
            data-mapbox-interactive-value="true"
            data-mapbox-animate-zoom-value="true"
            data-mapbox-animate-duration-ms-value="2000"
            style="height: 100%; width: 100%;"
          ></div>
        <% else %>
          <div class="h-100 w-100 d-flex align-items-center justify-content-center bg-white text-muted">
            <%= t(".mapbox_access_token_missing") %>
          </div>
        <% end %>
      </div>
      <div class="mt-2 text-muted"><strong><%= t(".address_label") %></strong> <%= map_address %></div>
    </div>

    <div class="col-12 col-lg-4">
      <div class="bg-white p-3 rounded" style="box-shadow: 0 0 18px rgba(0, 0, 0, 0.08);">
        <h2 class="h5 mb-3"><%= t(".contact_title") %></h2>

        <dl class="mb-0">
          <div class="mb-2">
            <dt class="text-muted small"><%= t(".guesthouse_name_label") %></dt>
            <dd class="mb-0"><%= @guesthouse_name.presence || t(".not_provided") %></dd>
          </div>

          <div class="mb-2">
            <dt class="text-muted small"><%= t(".owner_label") %></dt>
            <dd class="mb-0">
              <% owner_full_name = [@owner&.first_name, @owner&.last_name].compact.join(" ") %>
              <%= owner_full_name.presence || t(".not_provided") %>
            </dd>
          </div>

          <div class="mb-2">
            <dt class="text-muted small"><%= t(".postal_address_label") %></dt>
            <dd class="mb-0"><%= @owner_postal_address.presence || t(".not_provided") %></dd>
          </div>

          <div class="mb-2">
            <dt class="text-muted small"><%= t(".phone_label") %></dt>
            <dd class="mb-0">
              <% if @owner_phone.present? %>
                <%= link_to @owner_phone, "tel:#{@owner_phone}", class: "text-decoration-none" %>
              <% else %>
                <%= t(".not_provided") %>
              <% end %>
            </dd>
          </div>

          <div>
            <dt class="text-muted small"><%= t(".email_label") %></dt>
            <dd class="mb-0">
              <% owner_email = @owner&.email.to_s %>
              <% if owner_email.present? %>
                <%= mail_to owner_email, owner_email, class: "text-decoration-none" %>
              <% else %>
                <%= t(".not_provided") %>
              <% end %>
            </dd>
          </div>
        </dl>
      </div>
    </div>
  </div>
</div>
